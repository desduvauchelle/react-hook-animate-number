{"version":3,"file":"index.modern.js","sources":["../src/easingFunctions.ts","../src/helpers.ts","../src/useAnimateNumber.tsx"],"sourcesContent":["// https://easings.net/#\n\n// x is a value for progress of the animation between 0 and 1\n\nexport type EasingFunction = (x: number) => number\nexport type EasingFunctionNames = \"easeInOutCubic\" | \"easeOutCirc\" | \"easeOutQuint\" | \"easeOutExpo\"\n\nconst easing: {\n\t[easingName: string]: EasingFunction\n} = {\n\teaseInOutCubic: (x: number): number => {\n\t\tif (x >= 1) return 1\n\t\treturn x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2\n\t},\n\teaseOutCirc: (x: number): number => {\n\t\tif (x >= 1) return 1\n\t\treturn Math.sqrt(1 - Math.pow(x - 1, 2))\n\t},\n\teaseOutQuint: (x: number): number => {\n\t\tif (x >= 1) return 1\n\t\treturn 1 - Math.pow(1 - x, 5)\n\t},\n\teaseOutExpo: (x: number): number => {\n\t\treturn x === 1 ? 1 : 1 - Math.pow(2, -10 * x)\n\t}\n}\n\nexport default easing","export function applyThousandSeparator(\n\tvalue: string,\n\tthousandSeparator: string,\n) {\n\tconst thousandsGroupRegex = /(\\d)(?=(\\d{3})+(?!\\d))/g;\n\tlet index = value.search(/[1-9]/);\n\tindex = index === -1 ? value.length : index;\n\treturn (\n\t\tvalue.substring(0, index) +\n\t\tvalue.substring(index, value.length).replace(thousandsGroupRegex, '$1' + thousandSeparator)\n\t);\n}","import { useState, useEffect, useRef, useCallback } from 'react'\nimport easing, { EasingFunctionNames } from './easingFunctions'\nimport { applyThousandSeparator } from './helpers'\nconst FPS = 60\n\n\nexport type UseAnimateNumberProps = {\n\tnumber: number,\n\tdurationInMs?: number,\n\tdecimalPlaces?: number,\n\tthousandSeparator?: ',' | null,\n\teasingFunctionName?: EasingFunctionNames,\n\tsetInitialValue?: boolean,\n\tdebug?: boolean\n}\n\nexport type UseAnimateType = (props: UseAnimateNumberProps) => { number: number, isAnimating: boolean, isGoingUp: boolean }\n\nconst useAnimateNumber: UseAnimateType =\n\t({\n\t\tnumber = 0,\n\t\tdurationInMs = 4000,\n\t\tdecimalPlaces = 0,\n\t\tthousandSeparator = ',',\n\t\teasingFunctionName = \"easeOutExpo\",\n\t\tsetInitialValue = false,\n\t\tdebug = false\n\t}) => {\n\t\tconst [currentNumber, setCurrentNumber] = useState(0)\n\t\tconst [originalNumber, setOriginalNumber] = useState(setInitialValue ? number : 0)\n\t\tconst [currentTarget, setCurrentTarget] = useState(0)\n\t\tconst [step, setStep] = useState(0)\n\t\tconst [data, setData] = useState({\n\t\t\tcurrentNumber: 0,\n\t\t\toriginalNumber: setInitialValue ? number : 0,\n\t\t\tstep: 0,\n\t\t\tisGoingUp: false,\n\t\t\tisAnimating: false\n\t\t})\n\t\tconst requestRef = useRef<number>()\n\t\tconst mountedRef = useRef<boolean>(true)\n\t\tconst previousTimeRef = useRef<undefined | number>()\n\n\n\t\tconst animate = useCallback((time: number) => {\n\t\t\tif (!mountedRef.current) return\n\t\t\tif (previousTimeRef.current === undefined) {\n\t\t\t\tpreviousTimeRef.current = time\n\t\t\t\trequestRef.current = requestAnimationFrame(animate)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst reset = () => {\n\t\t\t\tsetData({\n\t\t\t\t\tcurrentNumber: number,\n\t\t\t\t\toriginalNumber: number,\n\t\t\t\t\tstep: 0,\n\t\t\t\t\tisGoingUp: false,\n\t\t\t\t\tisAnimating: false\n\t\t\t\t})\n\t\t\t\tpreviousTimeRef.current = undefined\n\t\t\t\tif (requestRef.current) cancelAnimationFrame(requestRef.current)\n\t\t\t\trequestRef.current = undefined\n\t\t\t}\n\n\t\t\tif (typeof number !== \"number\") {\n\t\t\t\ttry {\n\t\t\t\t\tnumber = parseFloat(number)\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(\"useAnimateNumber: number is not a number\")\n\t\t\t\t\treset()\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (number === data.currentNumber) {\n\t\t\t\treset()\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst deltaTime = time - previousTimeRef.current\n\n\t\t\t// Animation is finished\n\t\t\tif (deltaTime >= durationInMs) {\n\t\t\t\treset()\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t//\n\t\t\t// Animation - Update the data using easing function\n\t\t\t//\n\t\t\tlet easingFunction = easing.easeOutExpo\n\t\t\tif (easingFunctionName && easing[easingFunctionName]) {\n\t\t\t\teasingFunction = easing[easingFunctionName]\n\t\t\t}\n\n\t\t\tconst progress = deltaTime / durationInMs\n\t\t\tconst percentageOfTargetValue = easingFunction(progress)\n\t\t\tlet currentValue = percentageOfTargetValue * number\n\t\t\tsetData(previousData => {\n\t\t\t\tconst isGoingUp = number > previousData.originalNumber\n\t\t\t\tif (!isGoingUp) {\n\t\t\t\t\tcurrentValue = (1 - percentageOfTargetValue) * previousData.originalNumber + number\n\t\t\t\t}\n\t\t\t\tif (currentValue !== 0) {\n\t\t\t\t\tcurrentValue = parseFloat(currentValue.toFixed(decimalPlaces))\n\t\t\t\t}\n\t\t\t\tif (thousandSeparator !== null) {\n\t\t\t\t\tcurrentValue = parseFloat(applyThousandSeparator(currentValue.toString(), thousandSeparator))\n\t\t\t\t}\n\t\t\t\tif (isGoingUp && currentValue > number) {\n\t\t\t\t\tcurrentValue = number\n\t\t\t\t}\n\t\t\t\tif (!isGoingUp && currentValue < number) {\n\t\t\t\t\tcurrentValue = number\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\t...previousData,\n\t\t\t\t\tcurrentNumber: currentValue,\n\t\t\t\t\tisGoingUp,\n\t\t\t\t\tisAnimating: true\n\t\t\t\t}\n\t\t\t})\n\t\t\trequestRef.current = window.requestAnimationFrame(animate)\n\t\t}, [number, durationInMs, decimalPlaces, easingFunctionName])\n\n\n\t\tuseEffect(() => {\n\t\t\trequestRef.current = window.requestAnimationFrame(animate)\n\t\t\treturn () => {\n\t\t\t\tif (requestRef.current) cancelAnimationFrame(requestRef.current)\n\t\t\t}\n\t\t}, [number])\n\n\n\n\t\treturn {\n\t\t\tnumber: data.currentNumber,\n\t\t\tisGoingUp: data.isGoingUp,\n\t\t\tisAnimating: data.isAnimating\n\t\t}\n\t}\n\nexport default useAnimateNumber\n"],"names":["easing","easeInOutCubic","x","Math","pow","easeOutCirc","sqrt","easeOutQuint","easeOutExpo","applyThousandSeparator","value","thousandSeparator","thousandsGroupRegex","index","search","length","substring","replace","useAnimateNumber","_ref","number","_ref$number","_ref$durationInMs","durationInMs","_ref$decimalPlaces","decimalPlaces","_ref$thousandSeparato","_ref$easingFunctionNa","easingFunctionName","_ref$setInitialValue","setInitialValue","_useState","useState","_useState2","_useState3","_useState4","_useState5","currentNumber","originalNumber","step","isGoingUp","isAnimating","data","setData","requestRef","useRef","mountedRef","previousTimeRef","animate","useCallback","time","current","undefined","requestAnimationFrame","reset","cancelAnimationFrame","parseFloat","e","console","error","deltaTime","easingFunction","progress","percentageOfTargetValue","currentValue","previousData","toFixed","toString","_extends","window","useEffect"],"mappings":"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"}