{"version":3,"file":"index.modern.js","sources":["../src/easingFunctions.ts","../src/useAnimateNumber.tsx"],"sourcesContent":["// https://easings.net/#\n\n// x is a value for progress of the animation between 0 and 1\n\nexport type EasingFunction = (x: number) => number\nexport type EasingFunctionNames = \"easeInOutCubic\" | \"easeOutCirc\" | \"easeOutQuint\" | \"easeOutExpo\"\n\nconst easing: {\n\t[easingName: string]: EasingFunction\n} = {\n\teaseInOutCubic: (x: number): number => {\n\t\tif (x >= 1) return 1\n\t\treturn x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2\n\t},\n\teaseOutCirc: (x: number): number => {\n\t\tif (x >= 1) return 1\n\t\treturn Math.sqrt(1 - Math.pow(x - 1, 2))\n\t},\n\teaseOutQuint: (x: number): number => {\n\t\tif (x >= 1) return 1\n\t\treturn 1 - Math.pow(1 - x, 5)\n\t},\n\teaseOutExpo: (x: number): number => {\n\t\treturn x === 1 ? 1 : 1 - Math.pow(2, -10 * x)\n\t}\n}\n\nexport default easing","import { useState, useEffect, useRef, useCallback } from 'react'\nimport easing, { EasingFunctionNames } from './easingFunctions'\nconst FPS = 60\n\n\nexport type UseAnimateNumberProps = {\n\tnumber: number,\n\tdurationInMs?: number,\n\tdecimalPlaces?: number,\n\teasingFunctionName?: EasingFunctionNames,\n\tsetInitialValue?: boolean,\n\tdebug?: boolean\n}\n\nexport type UseAnimateType = (props: UseAnimateNumberProps) => { number: number, isAnimating: boolean, isGoingUp: boolean }\n\nconst useAnimateNumber: UseAnimateType =\n\t({\n\t\tnumber = 0,\n\t\tdurationInMs = 4000,\n\t\tdecimalPlaces = 0,\n\t\teasingFunctionName = \"easeOutExpo\",\n\t\tsetInitialValue = false,\n\t\tdebug = false\n\t}) => {\n\t\tconst [currentNumber, setCurrentNumber] = useState(0)\n\t\tconst [originalNumber, setOriginalNumber] = useState(setInitialValue ? number : 0)\n\t\tconst [currentTarget, setCurrentTarget] = useState(0)\n\t\tconst [step, setStep] = useState(0)\n\t\tconst [data, setData] = useState({\n\t\t\tcurrentNumber: 0,\n\t\t\toriginalNumber: setInitialValue ? number : 0,\n\t\t\tstep: 0,\n\t\t\tisGoingUp: false,\n\t\t\tisAnimating: false\n\t\t})\n\t\tconst requestRef = useRef<number>()\n\t\tconst mountedRef = useRef<boolean>(true)\n\t\tconst previousTimeRef = useRef<undefined | number>()\n\n\n\t\tconst animate = useCallback((time: number) => {\n\t\t\tif (!mountedRef.current) return\n\t\t\tif (previousTimeRef.current === undefined) {\n\t\t\t\tpreviousTimeRef.current = time\n\t\t\t\trequestRef.current = requestAnimationFrame(animate)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst reset = () => {\n\t\t\t\tsetData({\n\t\t\t\t\tcurrentNumber: number,\n\t\t\t\t\toriginalNumber: number,\n\t\t\t\t\tstep: 0,\n\t\t\t\t\tisGoingUp: false,\n\t\t\t\t\tisAnimating: false\n\t\t\t\t})\n\t\t\t\tpreviousTimeRef.current = undefined\n\t\t\t\tif (requestRef.current) cancelAnimationFrame(requestRef.current)\n\t\t\t\trequestRef.current = undefined\n\t\t\t}\n\n\t\t\tif (typeof number !== \"number\") {\n\t\t\t\ttry {\n\t\t\t\t\tnumber = parseFloat(number)\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(\"useAnimateNumber: number is not a number\")\n\t\t\t\t\treset()\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (number === data.currentNumber) {\n\t\t\t\treset()\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst deltaTime = time - previousTimeRef.current\n\n\t\t\t// Animation is finished\n\t\t\tif (deltaTime >= durationInMs) {\n\t\t\t\treset()\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t//\n\t\t\t// Animation - Update the data using easing function\n\t\t\t//\n\t\t\tlet easingFunction = easing.easeOutExpo\n\t\t\tif (easingFunctionName && easing[easingFunctionName]) {\n\t\t\t\teasingFunction = easing[easingFunctionName]\n\t\t\t}\n\n\t\t\tconst progress = deltaTime / durationInMs\n\t\t\tconst percentageOfTargetValue = easingFunction(progress)\n\t\t\tlet currentValue = percentageOfTargetValue * number\n\t\t\tsetData(previousData => {\n\t\t\t\tconst isGoingUp = number > previousData.originalNumber\n\t\t\t\tif (!isGoingUp) {\n\t\t\t\t\tcurrentValue = (1 - percentageOfTargetValue) * previousData.originalNumber + number\n\t\t\t\t}\n\t\t\t\tif (currentValue !== 0) {\n\t\t\t\t\tcurrentValue = parseFloat(currentValue.toFixed(decimalPlaces))\n\t\t\t\t}\n\t\t\t\tif (isGoingUp && currentValue > number) {\n\t\t\t\t\tcurrentValue = number\n\t\t\t\t}\n\t\t\t\tif (!isGoingUp && currentValue < number) {\n\t\t\t\t\tcurrentValue = number\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\t...previousData,\n\t\t\t\t\tcurrentNumber: currentValue,\n\t\t\t\t\tisGoingUp,\n\t\t\t\t\tisAnimating: true\n\t\t\t\t}\n\t\t\t})\n\t\t\trequestRef.current = window.requestAnimationFrame(animate)\n\t\t}, [number, durationInMs, decimalPlaces, easingFunctionName])\n\n\n\t\tuseEffect(() => {\n\t\t\trequestRef.current = window.requestAnimationFrame(animate)\n\t\t\treturn () => {\n\t\t\t\tif (requestRef.current) cancelAnimationFrame(requestRef.current)\n\t\t\t}\n\t\t}, [number])\n\n\n\n\t\treturn {\n\t\t\tnumber: data.currentNumber,\n\t\t\tisGoingUp: data.isGoingUp,\n\t\t\tisAnimating: data.isAnimating\n\t\t}\n\t}\n\nexport default useAnimateNumber\n"],"names":["easing","easeInOutCubic","x","Math","pow","easeOutCirc","sqrt","easeOutQuint","easeOutExpo","useAnimateNumber","number","durationInMs","decimalPlaces","easingFunctionName","setInitialValue","useState","currentNumber","originalNumber","step","isGoingUp","isAnimating","data","setData","requestRef","useRef","mountedRef","previousTimeRef","animate","useCallback","time","current","undefined","requestAnimationFrame","reset","cancelAnimationFrame","parseFloat","e","console","error","deltaTime","easingFunction","progress","percentageOfTargetValue","currentValue","previousData","toFixed","window","useEffect"],"mappings":"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"}